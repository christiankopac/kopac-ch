{{ define "head" }}
  {{/* Prefetch recent posts for faster navigation */}}
  {{ if .Params.recent }}
    {{ $blogSection := .Site.GetPage (.Site.Params.blog_section_path | default "/posts") }}
    {{ $max := .Params.recent_max | default 5 }}
    {{ range first $max $blogSection.Pages }}
      <link rel="prefetch" href="{{ .Permalink }}" as="document">
    {{ end }}
  {{ end }}
{{ end }}

{{ define "content" }}
<main class="home">
  <!-- Theme toggle - subtle, top corner -->
  <div class="theme-toggle-wrapper">
    <button id="theme-toggle" aria-label="Toggle theme" title="Toggle theme">
      <svg class="theme-icon theme-icon-sun" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
        <circle cx="12" cy="12" r="5"></circle>
        <line x1="12" y1="1" x2="12" y2="3"></line>
        <line x1="12" y1="21" x2="12" y2="23"></line>
        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
        <line x1="1" y1="12" x2="3" y2="12"></line>
        <line x1="21" y1="12" x2="23" y2="12"></line>
        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
      </svg>
      <svg class="theme-icon theme-icon-moon" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
      </svg>
    </button>
  </div>

  <div class="home-content-wrapper">
    <!-- Personal introduction -->
    {{ with .Params.name }}
    <div class="home-intro">
      {{ $avatar := $.Params.avatar }}
      {{ if $avatar }}
      <img src="{{ $avatar | relURL }}" alt="{{ . }}" class="intro-avatar">
      {{ else }}
      <div class="intro-avatar-container">
        <picture class="intro-avatar-picture">
          <source srcset="{{ "img/avatar.avif" | relURL }}" type="image/avif">
          <source srcset="{{ "img/avatar.webp" | relURL }}" type="image/webp">
          <img src="{{ "img/avatar.webp" | relURL }}" alt="{{ . }}" class="intro-avatar intro-avatar-original">
        </picture>
        <img src="{{ "img/avatar_dithered.png" | relURL }}" alt="{{ . }}" class="intro-avatar intro-avatar-dithered">
      </div>
      {{ end }}
      
      <div class="intro-text">
        <h1>{{ . }}</h1>
        {{ with $.Params.bio }}
        <p class="intro-bio">{{ . | markdownify }}</p>
        {{ end }}
      </div>
    </div>
    {{ end }}

    <!-- Main content / About text -->
    {{ with .Content }}
    <div class="home-about">
      {{ . }}
    </div>
    {{ end }}

    <!-- Navigation - Integrated naturally -->
    {{ with .Site.Params.sections }}
    <nav class="home-explore">
      <span class="explore-label">Explore</span>
      {{ range . }}
        {{ if .is_external }}
          <a href="{{ .path }}" target="_blank" rel="noopener noreferrer">{{ .name }}</a>
        {{ else }}
          <a href="{{ .path | relURL }}">{{ .name }}</a>
        {{ end }}
      {{ end }}
    </nav>
    {{ end }}

    <!-- Social links - More integrated -->
    {{ with .Params.links }}
    <div class="home-connect">
      <span class="connect-label">Connect</span>
      <div class="connect-links">
        {{ range . }}
        <a href="{{ .url }}" rel="me noopener noreferrer" target="_blank" aria-label="{{ .name }}" title="{{ .name }}">
          {{ if eq .icon "github" }}
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
            <path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"></path>
          </svg>
          <span>{{ .name }}</span>
          {{ else if or (eq .icon "email") (eq .icon "mail") }}
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
            <path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"></path>
            <polyline points="22,6 12,13 2,6"></polyline>
          </svg>
          <span>{{ .name }}</span>
          {{ else if eq .icon "twitter" }}
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
            <path d="M23 3a10.9 10.9 0 0 1-3.14 1.53 4.48 4.48 0 0 0-7.86 3v1A10.66 10.66 0 0 1 3 4s-4 9 5 13a11.64 11.64 0 0 1-7 2c9 5 20 0 20-11.5a4.5 4.5 0 0 0-.08-.83A7.72 7.72 0 0 0 23 3z"></path>
          </svg>
          <span>{{ .name }}</span>
          {{ else if eq .icon "bluesky" }}
          <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
            <path d="M12 10.5c-2-3.5-5-6-7-6-1.5 0-2.5 1-2.5 3.5 0 4.5 2 7 4.5 8.5 1.5.8 3 1 4.5 1-.5-.5-1-1.5-1-3 0-2 1-3 1.5-3.5zm0 0c2-3.5 5-6 7-6 1.5 0 2.5 1 2.5 3.5 0 4.5-2 7-4.5 8.5-1.5.8-3 1-4.5 1 .5-.5 1-1.5 1-3 0-2-1-3-1.5-3.5z"/>
            <path d="M12 14c-1 0-2 .5-2.5 1.5-.3.5-.5 1.5-.5 2.5s.5 2.5 1.5 3c.5.3 1.5.5 1.5.5s1 0 1.5-.5c1-.5 1.5-2 1.5-3s-.2-2-.5-2.5c-.5-1-1.5-1.5-2.5-1.5z"/>
          </svg>
          <span>{{ .name }}</span>
          {{ else if eq .icon "mastodon" }}
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
            <path d="M21.327 8.566c0-4.339-2.843-5.61-2.843-5.61-1.433-.658-3.894-.935-6.451-.956h-.063c-2.557.021-5.016.298-6.45.956 0 0-2.843 1.272-2.843 5.61 0 .993-.019 2.181.012 3.441.103 4.243.778 8.425 4.701 9.463 1.809.479 3.362.579 4.612.51 2.268-.126 3.541-.809 3.541-.809l-.075-1.646s-1.621.511-3.441.449c-1.804-.062-3.707-.194-3.999-2.409a4.523 4.523 0 0 1-.04-.621s1.77.433 4.014.536c1.372.063 2.658-.08 3.965-.236 2.506-.299 4.688-1.843 4.962-3.254.434-2.223.398-5.424.398-5.424z"/>
          </svg>
          <span>{{ .name }}</span>
          {{ else if eq .icon "twitch" }}
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
            <path d="M16 11V7M21 2H3v16h5v4l4-4h5l4-4V2zM11 11V7"/>
          </svg>
          <span>{{ .name }}</span>
          {{ else if eq .icon "instagram" }}
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
            <rect x="2" y="2" width="20" height="20" rx="5" ry="5"/>
            <circle cx="12" cy="12" r="4"/>
            <circle cx="17.5" cy="6.5" r="0.5" fill="currentColor"/>
          </svg>
          <span>{{ .name }}</span>
          {{ else if eq .icon "linkedin" }}
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
            <path d="M16 8a6 6 0 0 1 6 6v7h-4v-7a2 2 0 0 0-4 0v7h-4v-7a6 6 0 0 1 6-6z"/>
            <rect x="2" y="9" width="4" height="12"/>
            <circle cx="4" cy="4" r="2"/>
          </svg>
          <span>{{ .name }}</span>
          {{ else }}
          <span>{{ .name }}</span>
          {{ end }}
        </a>
        {{ end }}
      </div>
    </div>
    {{ end }}

    <!-- Recent posts - More integrated -->
    {{ if .Params.recent }}
    <section class="home-recent">
      <h2>Recent Writing</h2>
      {{ $blogSection := .Site.GetPage (.Site.Params.blog_section_path | default "/posts") }}
      {{ $max := .Params.recent_max | default 5 }}
      <ul class="recent-list">
        {{ range first $max $blogSection.Pages }}
        <li>
          <a href="{{ .Permalink }}">
            <span class="recent-title">{{ .Title }}</span>
            {{ with .Date }}
            <time datetime="{{ .Format "2006-01-02" }}">{{ .Format (.Site.Params.date_format | default "Jan 2, 2006") }}</time>
            {{ end }}
          </a>
        </li>
        {{ end }}
      </ul>
      {{ with $.Params.recent_more_text }}
      <a href="{{ $.Site.Params.blog_section_path | default "/posts" | relURL }}" class="recent-more">
        {{ . }}
      </a>
      {{ end }}
    </section>
    {{ end }}
  </div>
</main>
{{ end }}
